var app=angular.module("app",["dashboard","rulesets","my_rulesets","apks","ranking","analysts","notifications","settings","services.api","filters","ui.router","angular-loading-bar","ngAnimate","angularFileUpload","angularMoment","ui.bootstrap","mentio"]);app.controller("AppCtrl",["$scope","$rootScope","api","$state","$interval","$timeout",function(e,t,n,r,i,s){t.appVersion=window.appVersion,t.getTemplateUrl=function(e){return e};var o,u=n.getCurrentUser();u.success(function(e){t.user=e}).error(function(){t.user={anon:!0}}),e.app={layout:{}},localStorage&&localStorage.isCollapsed=="true"?e.app.layout.isCollapsed=!0:e.app.layout.isCollapsed=!1,e.$watch("app.layout.isCollapsed",function(){localStorage.isCollapsed=e.app.layout.isCollapsed}),t.$on("$stateChangeSuccess",function(){document.body.scrollTop=0,document.documentElement.scrollTop=0}),t.$watch("tooManyRequests",function(e,t){e!=t&&e==0&&s(function(){r.go(r.current,{},{reload:!0})},500)}),t.$watch("secondsToWait",function(e,n){e>0&&e<59&&!o&&(o=i(function(){t.secondsToWait--,t.secondsToWait<0&&(t.tooManyRequests=!1)},1e3,0)),n>0&&e<0&&(i.cancel(o),interval=undefined)})}]),app.controller("HeaderCtrl",["$scope","$rootScope","$location","api","$http","$upload","$interval","$uibModal",function(e,t,n,r,s,o,u,a){e.uploading=!1,e.uploadProgress=0,e.notifications=[],t.unreadNotifications=0,t.favicon=new Favico({animation:"none"}),e.getNotifications=function(){if(!t.user||!t.user.username)return!1;r.getNotifications().success(function(t){var n=t.results.slice(0,5);for(i=0;i<n.length;i+=1)if(n[i].apk)n[i].targetUrl="/apks/"+n[i].apk.sha256;else if(n[i].analyst_ref&&n[i].type!="rulesetvoteup"&&n[i].type!="rulesetvotedown")n[i].targetUrl="/analysts/"+n[i].analyst_ref.username;else if(n[i].type=="rulesetcomment"||n[i].type=="socialaccepted"||n[i].type=="socialrejected"||n[i].type=="rulesetvoteup"||n[i].type=="rulesetvotedown"||n[i].type=="rulesetmention")n[i].targetUrl="/rulesets/"+n[i].ruleset.id;e.notifications=n})},e.getNotifications(),t.getUnreadNotifications=function(){if(!t.user||!t.user.username)return!1;r.getUnreadNotifications().success(function(e){e.next?(t.favicon.badge(e.results.length+"+"),t.unreadNotifications=e.results.length+"+"):(t.unreadNotifications=e.results.length,t.favicon.badge(e.results.length))})},u(function(){t.getUnreadNotifications()},3e4),t.getUnreadNotifications(),e.markAsRead=function(t){t.read=!0,r.updateNotification(t).success(function(){e.getUnreadNotifications()})},t.$watch("user",function(){t.user&&(t.user.username?e.userIsLoggedIn=!0:e.userIsLoggedIn=!1)}),e.logout=function(){delete localStorage.authToken,delete sessionStorage.authToken,t.user={anon:!0}},e.openFeedbackModal=function(){var e=a.open({templateUrl:"/app/feedback-modal.html?"+window.appVersion,controller:"FeedbackModalController"})},e.openUploaderModal=function(){var e=a.open({templateUrl:"/app/uploader-modal.html",controller:"NGUploaderController",backdropClass:"fullscreen-modal",backdrop:"static"})}}]),app.controller("FeedbackModalController",["$http","$uibModalInstance","$scope",function(e,t,n){n.msg="",n.sending=!1,n.sent=!1,n.send=function(){n.sending=!0,e({method:"POST",data:$.param({msg:n.msg}),url:"/feedback",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).finally(function(){n.sending=!1,n.sent=!0,setTimeout(function(){t.close()},2e3)})},n.cancel=function(){t.close()}}]),app.controller("NGUploaderController",["$scope","$uibModalInstance","api","$upload","$rootScope",function(e,t,n,r,i){function s(t){if(!e.currentStep)return;n.getAPK(e.sha256).success(function(t){e.gettingAPKInfo=!1,e.apk=t,t.analyzed?(n.getAPKDetections(e.apk.sha256).success(function(t){e.expertDetections=[];for(var n=0;n<t.length;n++){var r=t[n];r.detected&&e.expertDetections.push(r)}e.gettingExpertDetections=!1}),n.getAPKSocialDetections(e.apk.sha256).success(function(t){e.socialDetections=t,e.gettingSocialDetections=!1}),n.getAPKVotes(e.sha256).success(function(t){e.votesData=t})):setTimeout(function(){s(e.sha256)},1e4)}).error(function(){setTimeout(function(){s(e.sha256)},1e4)})}e.currentStep=1,e.existingApk=!1,e.wrongMimeType=!1,e.gettingAPKInfo=!0,e.uploadError=!1,e.uploadProgress=0,e.gettingExpertDetections=!0,e.expertDetections=!1,e.gettingSocialDetections=!0,e.socialDetections=!1,e.socialDetectionsToolTip="",e.expertDetectionsToolTip="",e.apk={},e.upload=function(t){if(!t.length)return!1;e.checking_file=!0,t=t[0],e.file=t;var o=new FileReader,u=new FileReader;o.onloadend=function(t){var n=(new Uint8Array(t.target.result)).subarray(0,4),r="";for(var i=0;i<n.length;i++)r+=n[i].toString(16);if(r!="504b34"){e.uploadError="The file you are trying to upload is not a valid APK",e.checking_file=!1,e.currentStep=1,e.uploading=!1;return}e.checking_file=!1,e.currentStep=2,u.readAsBinaryString(e.file)},u.onloadend=function(o){!e.uploadError;var a=sha256_digest(u.result);e.sha256=a,n.getAPKUploadUrl(a).success(function(o){var u=o.upload_url;e.currentStep=2,o.upload_url&&r.upload({url:u,method:"POST",file:t}).progress(function(t){e.uploadProgress=parseInt(100*t.loaded/t.total)}).success(function(t,r,o,u){i.user.anon||n.forzeApkAnalysis(e.sha256).success(function(){}),e.currentStep=3,setTimeout(function(){s(e.apk.sha256)},3e3)}).error(function(t,n){n==415&&(e.uploadError="The file you are trying to upload is not a valid APK")}).finally(function(){e.uploading=!1})}).error(function(t,n,r,i){n==409?(e.currentStep=3,setTimeout(function(){s(e.apk.sha256)},5e3)):e.uploadError="Something wrong happened"})},o.readAsArrayBuffer(t)},e.close=function(){t.close()},e.detail_apk=function(){document.location.href="/apks/"+e.apk.sha256,e.close()}}]),app.controller("SidebarCtrl",["$scope","$rootScope","api","$location",function(e,t,n,r){e.rulesets_shown=!1,$(".rulesets-menu").hover(function(){var t=$(this).position().top+55;e.main_ruleset_button_hover=!0,$(".rulesets-sub-menu").stop().css("top",t+"px")},function(){e.main_ruleset_button_hover=!1,setTimeout(function(){!e.sub_ruleset_button_hover&&!e.main_ruleset_button_hover&&$(".rulesets-sub-menu").stop().css("top","")},100)}),$(".rulesets-sub-menu").hover(function(){var t=$(".rulesets-menu").position().top+55;e.sub_ruleset_button_hover=!0,$(".rulesets-sub-menu").stop().css("top",t+"px")},function(){e.sub_ruleset_button_hover=!1,setTimeout(function(){!e.sub_ruleset_button_hover&&!e.main_ruleset_button_hover&&$(".rulesets-sub-menu").stop().css("top","")},100)}),$(".rulesets-sub-menu").click(function(){$(".rulesets-sub-menu").stop().css("top","")}),e.go=function(e){r.path(e)}}]),app.controller("StaticViewController",["$scope",function(e){e.press=[{title:"The Black Hat Arsenal Europe 2016 Line-Up !",link:"http://www.toolswatch.org/2016/09/the-black-hat-arsenal-europe-2016-line-up/#koodous",image:"http://www.toolswatch.org/wp-content/uploads/2016/07/bh16europe_logo_black_updated2.png",date:new Date(2016,8,14),media_logo:"https://pbs.twimg.com/profile_images/769174492262391808/CwGJmdhh_400x400.jpg"},{title:"Koodous: VirusTotal (antivirus social) para Android",link:"http://blog.elhacker.net/2016/09/koodous-virustotal-antivirus-social-para-android.html",image:"https://4.bp.blogspot.com/-JhUlSkhGJlk/V852vcIOqjI/AAAAAAAAiTs/1XJluMFTh8kg1JW8P8rlgACDAHYUfxLLwCLcB/s200/unnamed.png",date:new Date(2016,8,6),media_logo:"https://pbs.twimg.com/profile_images/1330969532/e-peq1_400x400.png"},{title:"Una 'app' hecha en M\u00e1laga implica a expertos de todo el mundo para buscar virus en los m\u00f3viles",link:"http://www.diariosur.es/tecnologia/empresas/201609/03/hecha-malaga-implica-expertos-20160903203659.html",image:"http://www.diariosur.es/noticias/201609/03/media/cortadas/hispaseCo0A5_QUAAEgLEv-k7KI-U202680318564uzH-575x323@Diario%20Sur.jpg",date:new Date(2016,8,4),media_logo:"https://pbs.twimg.com/profile_images/740316941366222848/SZ_mL0XZ.jpg"},{title:"Koodous es un antivirus que crece gracias a la comunidad",link:"http://www.xatakandroid.com/aplicaciones-android/koodous-es-un-antivirus-que-crece-gracias-a-la-comunidad",image:"http://i.blogs.es/12871b/koodous-trio/1366_2000.jpg",date:new Date(2016,7,18),media_logo:"https://pbs.twimg.com/profile_images/460728038733258754/H4-nTceO_400x400.jpeg"},{title:"Koodous, el antivirus social hecho entre todos",link:"http://tecnologia.elpais.com/tecnologia/2016/08/12/actualidad/1470986862_544707.html",image:"http://ep01.epimg.net/tecnologia/imagenes/2016/08/12/actualidad/1470986862_544707_1470989327_noticia_normal_recorte1.jpg",date:new Date(2016,7,18),media_logo:"http://ep00.epimg.net/iconos/v1.x/v1.0/promos/promo_og_elpais.png"},{title:"Koodous presente en BlackHat USA Las Vegas 2016",link:"http://unaaldia.hispasec.com/2016/08/koodous-presente-en-blackhat-usa-las.html",image:"https://3.bp.blogspot.com/-FGgOXL2HNJU/V6EgRb77NxI/AAAAAAAAHhE/q0L7PrRLFxYjvxFGNjdvv-8uCDyDYROsACLcB/s1600/blackhat2016.jpeg",date:new Date(2016,7,3),media_logo:"https://pbs.twimg.com/profile_images/2784430190/016214ce6d462eb23e3195d0c69da853_400x400.png"},{title:"Clientes del BBVA, Santander y Ruralv\u00eda, en peligro por un virus en m\u00f3viles Android",link:"http://www.elconfidencial.com/tecnologia/2016-03-13/clientes-del-bbva-santander-y-ruralvia-en-peligro-por-un-virus-en-moviles-android_1167402/",image:"http://9www.ecestaticos.com/imagestatic/clipping/dda/bc9/4f8/ddabc94f8ea79f24d32bb48cf9d1df9a/clientes-del-bbva-santander-y-ruralvia-en-peligro-por-un-virus-en-moviles-android.jpg?mtime=1457719422",date:new Date(2016,2,13),media_logo:"https://pbs.twimg.com/profile_images/686938796856860673/PEmS0vTR_400x400.png"},{title:"Repaso al 2015. Koodous awakens :)",link:"http://unaaldia.hispasec.com/2016/01/repaso-al-2015-koodous-awakens.html",image:"http://4.bp.blogspot.com/-9cGFulpUrlo/Vo6ypxQ2wSI/AAAAAAAAFwU/QnJSv5rBYQM/s1600/Koodous_strings.png",date:new Date(2016,0,8),media_logo:"https://pbs.twimg.com/profile_images/2784430190/016214ce6d462eb23e3195d0c69da853_400x400.png"},{title:"Koodous alcanza el mill\u00f3n de aplicaciones Android fraudulentas detectadas",link:"http://unaaldia.hispasec.com/2015/10/koodous-alcanza-el-millon-de.html",image:"http://4.bp.blogspot.com/-iZ0oxogoPWE/Vh5jppPm_wI/AAAAAAAAE7A/i5fPBHbQMiQ/s1600/Koodous_1.png",date:new Date(2015,9,14),media_logo:"https://pbs.twimg.com/profile_images/2784430190/016214ce6d462eb23e3195d0c69da853_400x400.png"},{title:"Koodous: inteligencia colectiva para proteger tu Android",link:"http://unaaldia.hispasec.com/2015/07/koodous-inteligencia-colectiva-para.html",image:"http://3.bp.blogspot.com/-UAc_TY1HrnE/VYvlCYEcsdI/AAAAAAAAD4c/J8wHv2u47eA/s640/diagram-koodous.png",date:new Date(2015,6,6),media_logo:"https://pbs.twimg.com/profile_images/2784430190/016214ce6d462eb23e3195d0c69da853_400x400.png"}]}]);angular.module("app").config(["$httpProvider",function(e){e.interceptors.push(["$q","$rootScope","$injector",function(e,t,n){var r=[window.base_api_url+"/get_auth_token",window.base_api_url+"/register"],i;return t.tooManyRequests=!1,{request:function(t){if(r.indexOf(t.url)==-1){var n=sessionStorage.authToken?sessionStorage.authToken:localStorage.authToken;n&&(t.headers.Authorization="Token "+n)}return t||e.when(t)},responseError:function(n){if(n.status==429){t.tooManyRequests=!0,t.secondsToWait=0;try{var r=new RegExp(/\d{1,2}/);t.secondsToWait=r.exec(n.data.detail)[0]}catch(i){console.log(i)}}return e.reject(n)}}}])}]);app.config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/"),e.state("home",{url:"^/",templateUrl:"app/dashboard/dashboard.html",controller:"DashboardCtrl"}).state("dashboard",{url:"^/dashboard",templateUrl:"app/dashboard/dashboard.html",controller:"DashboardCtrl"}).state("login",{url:"^/login",templateUrl:"app/signinup/signinup.html",controller:"SignInUpController"}).state("register",{url:"^/register",templateUrl:"app/signinup/signinup.html",controller:"SignInUpController"}).state("activate",{url:"^/activate/:token",templateUrl:"app/signinup/signinup.html",controller:"SignInUpController"}).state("forgot_password",{url:"^/forgot_password",templateUrl:"app/signinup/signinup.html",controller:"SignInUpController"}).state("reset_password",{url:"^/reset_password?uid&token",templateUrl:"app/signinup/signinup.html",controller:"SignInUpController"}).state("rulesets",{url:"^/rulesets?search&page",templateUrl:"app/rulesets/rulesets.html",controller:"RulesetsCtrl"}).state("ruleset",{"abstract":!0,url:"^/rulesets/:id",templateUrl:"app/rulesets/ruleset.html",controller:"RulesetController"}).state("ruleset.main",{url:"^/rulesets/:id",templateUrl:"app/rulesets/ruleset.main.html",controller:"RulesetMainController"}).state("ruleset.detections",{url:"/detections?search&page",templateUrl:"app/rulesets/ruleset.detections.html",controller:"RulesetDetectionsController"}).state("my_rulesets",{url:"^/my_rulesets",templateUrl:"app/my_rulesets/rulesets.html",controller:"MyRulesetsCtrl"}).state("my_rulesets_detail",{url:"^/my_rulesets/:id",templateUrl:"app/my_rulesets/ruleset_detail.html",controller:"MyRuleSetDetailController"}).state("apks",{url:"^/apks?search&page",templateUrl:"app/apks/apks.html",controller:"APKsCtrl"}).state("ruleset_apks",{url:"^/rulesets/:ruleset_id/apks?search&page",templateUrl:"app/apks/apks.html",controller:"APKsCtrl"}).state("device_apks",{url:"^/devices/:android_id/apks?search&page",templateUrl:"app/apks/apks.html",controller:"APKsCtrl"}).state("apk",{"abstract":!0,url:"^/apks/{sha256:[A-Fa-f0-9]{64}}",templateUrl:"app/apks/apk.html",controller:"APKDetailCtrl"}).state("apk.main",{url:"^/apks/{sha256:[A-Fa-f0-9]{64}}",templateUrl:"app/apks/apk.main.html",controller:"APKMainController"}).state("apk.comments",{url:"^/apks/{sha256:[A-Fa-f0-9]{64}}/comments",templateUrl:"app/apks/apk.comments.html"+window.appVersion,controller:"APKCommentsController"}).state("apk.analysis",{url:"^/apks/{sha256:[A-Fa-f0-9]{64}}/analysis",templateUrl:"app/apks/apk.analysis.html"+window.appVersion,controller:"APKAnalysisController"}).state("apk.metada",{url:"^/apks/{sha256:[A-Fa-f0-9]{64}}/metadata",templateUrl:"app/apks/apk.metadata.html"+window.appVersion,controller:"APKMetadataController"}).state("analyst",{"abstract":!0,url:"^/analysts/:username",templateUrl:"app/analysts/analyst.html",controller:"AnalystController"}).state("analyst.main",{url:"",templateUrl:"app/analysts/analyst.main.html",controller:"AnalystMainController"}).state("analyst.rulesets",{url:"/rulesets",templateUrl:"app/analysts/analyst.rulesets.html",controller:"AnalystRulesetsController"}).state("analyst.comments",{url:"/comments",templateUrl:"app/analysts/analyst.comments.html",controller:"AnalystCommentsController"}).state("analyst.following",{url:"/following",templateUrl:"app/analysts/analyst.following.html",controller:"AnalystFollowingController"}).state("analyst.followers",{url:"/followers",templateUrl:"app/analysts/analyst.followers.html",controller:"AnalystFollowersController"}).state("ranking",{url:"^/ranking",templateUrl:"app/ranking/ranking.html",controller:"RankingCtrl"}).state("settings",{"abstract":!0,url:"^/settings",templateUrl:"app/settings/settings.html",controller:"SettingsController"}).state("settings.profile",{url:"/profile",templateUrl:"app/settings/settings.profile.html",controller:"ProfileController"}).state("settings.account",{url:"/account",templateUrl:"app/settings/settings.account.html",controller:"AccountController"}).state("settings.notifications",{url:"/notifications",templateUrl:"app/settings/settings.notifications.html",controller:"NotificationsController"}).state("settings.link_device",{url:"/link_device",templateUrl:"app/settings/settings.link_device.html",controller:"DevicesController"}).state("notifications",{url:"^/notifications",templateUrl:"app/notifications/notifications.html",controller:"NotificationsCtrl"}).state("notifications_search",{url:"^/notifications/:notification_type",templateUrl:"app/notifications/notifications.html",controller:"NotificationsCtrl"}).state("about",{url:"^/about",templateUrl:"app/static_views/about.html",controller:"StaticViewController"}).state("terms",{url:"^/terms",templateUrl:"app/static_views/terms.html",controller:"StaticViewController"}).state("press",{url:"^/press",templateUrl:"app/static_views/press.html",controller:"StaticViewController"})}]),angular.module("app").config(["$locationProvider",function(e){e.html5Mode({enabled:!0,requireBase:!1})}]);angular.module("analysts",[]),angular.module("analysts").controller("AnalystController",["$scope","$rootScope","$stateParams","$location","api",function(e,t,n,r,i){e.username=n.username,e.isFollowed=!1,e.loadingRelInfo=!0,e.isCurrentUser=!1,t.section="analyst",t.$watch("user",function(){t.user?e.isCurrentUser=t.user.username==n.username?!0:!1:e.isCurrentUser=!1},!0),i.getAnalyst(e.username).success(function(n){e.analyst=n,i.getUserFollowers(e.analyst.username,1,1,{username:t.user.username}).success(function(t){e.isFollowed=t.results.length?!0:!1}).error(function(){e.isFollowed=!1}).finally(function(){e.loadingRelInfo=!1})}).error(function(){r.path("/")}),e.follow=function(){i.followUser(e.username).success(function(t){e.isFollowed=!0,e.analyst.total_followers++})},e.unFollow=function(){i.unFollowUser(e.username).success(function(t){e.isFollowed=!1,e.analyst.total_followers--})}}]),angular.module("analysts").controller("AnalystMainController",["$scope","$rootScope","$stateParams","$location","api",function(e,t,n,r,i){e.new_invitation={email:""},t.profile_section="main",e.$parent.$watch("analyst",function(){e.$parent.analyst&&(e.getAnalystActivity(),e.getInvitations())},!0),e.getAnalystActivity=function(){i.getAnalystActivity(e.analyst.username).success(function(t){e.activity=t.results})},e.getInvitations=function(){i.getInvitations().success(function(t){e.invitations=t})},e.sendInvitation=function(){e.sending=!0,i.createInvitation(e.new_invitation).success(function(t){e.getInvitations(),e.new_invitation={}}).finally(function(){e.sending=!1})},e.deleteInvitation=function(t){i.deleteInvitation(t).success(function(t){e.getInvitations()})}}]),angular.module("analysts").controller("AnalystRulesetsController",["$scope","$rootScope","$stateParams","$location","api",function(e,t,n,r,i){e.rulesetsCurrentPage=1,e.rulesetsItemsPerPage=10,e.rulesetsMaxSize=5,t.profile_section="rulesets",e.$parent.$watch("analyst",function(){e.$parent.analyst&&e.getUserRulesets()},!0),e.getUserRulesets=function(){i.getUserRulesets(e.analyst.username,e.rulesetsCurrentPage,e.rulesetsItemsPerPage,{ordering:"-created_on"}).success(function(t){e.rulesets=t.results,e.rulesetsTotalItems=t.count})},e.rulesetPageChange=function(){e.getUserRulesets()}}]),angular.module("analysts").controller("AnalystCommentsController",["$scope","$rootScope","$stateParams","$location","api",function(e,t,n,r,i){e.itemsPerPage=10,e.currentPage=1,e.maxSize=5,t.profile_section="comments",e.totalComments=0,e.$parent.$watch("analyst",function(){e.$parent.analyst&&e.getUserComments()},!0),e.getUserComments=function(){i.getUserComments(e.analyst.username,!1,{ordering:"-created_on"}).success(function(t){e.comments=t.results,e.totalComments=t.count})},e.pageChanged=function(){e.getUserComments()},e.getRefLink=function(e){if(e.apk)return"/apks/"+e.apk;if(e.ruleset)return"/rulesets/"+e.ruleset}}]),angular.module("analysts").controller("AnalystFollowingController",["$scope","$rootScope","$stateParams","$location","api",function(e,t,n,r,i){t.profile_section="following",e.following=[],e.next=null,e.$parent.$watch("analyst",function(){e.$parent.analyst&&e.getUserFollowing()},!0),e.getUserFollowing=function(){i.getUserFollowingInifite(e.analyst.username,e.next).success(function(t){e.following=e.following.concat(t.results),e.next=t.next})}}]),angular.module("analysts").controller("AnalystFollowersController",["$scope","$rootScope","$stateParams","$location","api",function(e,t,n,r,i){t.profile_section="followers",e.followers=[],e.next=null,e.$parent.$watch("analyst",function(){e.$parent.analyst&&e.getUserFollowers()},!0),e.getUserFollowers=function(){i.getUserFollowersInifite(e.analyst.username,e.next).success(function(t){e.followers=e.followers.concat(t.results),e.next=t.next})}}]);angular.module("analysts",[]),angular.module("analysts").controller("AnalystController",["$scope","$rootScope","$stateParams","$location","api",function(e,t,n,r,i){e.username=n.username,e.isFollowed=!1,e.loadingRelInfo=!0,e.isCurrentUser=!1,t.section="analyst",t.$watch("user",function(){t.user?e.isCurrentUser=t.user.username==n.username?!0:!1:e.isCurrentUser=!1},!0),i.getAnalyst(e.username).success(function(n){e.analyst=n,i.getUserFollowers(e.analyst.username,1,1,{username:t.user.username}).success(function(t){e.isFollowed=t.results.length?!0:!1}).error(function(){e.isFollowed=!1}).finally(function(){e.loadingRelInfo=!1})}).error(function(){r.path("/")}),e.follow=function(){i.followUser(e.username).success(function(t){e.isFollowed=!0,e.analyst.total_followers++})},e.unFollow=function(){i.unFollowUser(e.username).success(function(t){e.isFollowed=!1,e.analyst.total_followers--})}}]),angular.module("analysts").controller("AnalystMainController",["$scope","$rootScope","$stateParams","$location","api",function(e,t,n,r,i){e.new_invitation={email:""},t.profile_section="main",e.$parent.$watch("analyst",function(){e.$parent.analyst&&(e.getAnalystActivity(),e.getInvitations())},!0),e.getAnalystActivity=function(){i.getAnalystActivity(e.analyst.username).success(function(t){e.activity=t.results})},e.getInvitations=function(){i.getInvitations().success(function(t){e.invitations=t})},e.sendInvitation=function(){e.sending=!0,i.createInvitation(e.new_invitation).success(function(t){e.getInvitations(),e.new_invitation={}}).finally(function(){e.sending=!1})},e.deleteInvitation=function(t){i.deleteInvitation(t).success(function(t){e.getInvitations()})}}]),angular.module("analysts").controller("AnalystRulesetsController",["$scope","$rootScope","$stateParams","$location","api",function(e,t,n,r,i){e.rulesetsCurrentPage=1,e.rulesetsItemsPerPage=10,e.rulesetsMaxSize=5,t.profile_section="rulesets",e.$parent.$watch("analyst",function(){e.$parent.analyst&&e.getUserRulesets()},!0),e.getUserRulesets=function(){i.getUserRulesets(e.analyst.username,e.rulesetsCurrentPage,e.rulesetsItemsPerPage,{ordering:"-created_on"}).success(function(t){e.rulesets=t.results,e.rulesetsTotalItems=t.count})},e.rulesetPageChange=function(){e.getUserRulesets()}}]),angular.module("analysts").controller("AnalystCommentsController",["$scope","$rootScope","$stateParams","$location","api",function(e,t,n,r,i){e.itemsPerPage=10,e.currentPage=1,e.maxSize=5,t.profile_section="comments",e.totalComments=0,e.$parent.$watch("analyst",function(){e.$parent.analyst&&e.getUserComments()},!0),e.getUserComments=function(){i.getUserComments(e.analyst.username,!1,{ordering:"-created_on"}).success(function(t){e.comments=t.results,e.totalComments=t.count})},e.pageChanged=function(){e.getUserComments()},e.getRefLink=function(e){if(e.apk)return"/apks/"+e.apk;if(e.ruleset)return"/rulesets/"+e.ruleset}}]),angular.module("analysts").controller("AnalystFollowingController",["$scope","$rootScope","$stateParams","$location","api",function(e,t,n,r,i){t.profile_section="following",e.following=[],e.next=null,e.$parent.$watch("analyst",function(){e.$parent.analyst&&e.getUserFollowing()},!0),e.getUserFollowing=function(){i.getUserFollowingInifite(e.analyst.username,e.next).success(function(t){e.following=e.following.concat(t.results),e.next=t.next})}}]),angular.module("analysts").controller("AnalystFollowersController",["$scope","$rootScope","$stateParams","$location","api",function(e,t,n,r,i){t.profile_section="followers",e.followers=[],e.next=null,e.$parent.$watch("analyst",function(){e.$parent.analyst&&e.getUserFollowers()},!0),e.getUserFollowers=function(){i.getUserFollowersInifite(e.analyst.username,e.next).success(function(t){e.followers=e.followers.concat(t.results),e.next=t.next})}}]);angular.module("apks",["ui.bootstrap","ngSanitize"]),angular.module("apks").controller("APKsCtrl",["$scope","$rootScope","api","$location","$stateParams","$state",function(e,t,n,r,i,s){e.apks=[],t.section="apks",e.showFilters=!1,e.filters={analyzed:i.analyzed?i.analyzed:"",repo:i.repo?i.repo:""},t.search=i.search?i.search:"",e.nextPage=!1,e.$watch("filters",function(n,r){e.filters.search=t.search,e.loading||e.getAPKS()},!0),$(window).scroll(function(){$(window).scrollTop()+$(window).height()==$(document).height()&&!e.loading&&e.nextPage&&e.getAPKS()}),e.$on("$destroy",function(e){$(window).unbind("scroll")}),e.getAPKS=function(){function s(n){e.totalApks=n.count,e.nextPage=n.next,t&&(t.sha256||t.sha1||t.md5)?n.results.length?r.path("/apks/"+n.results[0].sha256):e.apks=e.apks.concat(n.results):e.apks=e.apks.concat(n.results)}e.loading=!0,e.searchError=!1;var t=e.filters;i.ruleset_id?n.getRulesetDetections(i.ruleset_id,e.nextPage,t).success(s).error(function(t){e.searchError=t.error,e.apks=[]}).finally(function(){e.loading=!1}):i.android_id?n.getDeviceAPKs(i.android_id,e.nextPage,t).success(s).error(function(t){e.searchError=t.error,e.apks=[],e.totalItems=0}).finally(function(){e.loading=!1}):n.getAPKs(e.nextPage,t).success(s).error(function(t){e.searchError=t.error,e.apks=[]}).finally(function(){e.loading=!1})},e.searchApks=function(){t.search=t.search.replace(/#/g,"tag:"),s.go(s.current.name,{search:t.search})}}]),angular.module("app").filter("prettify",function(){function e(e){return e=e?e:"",e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),e.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(e){var t="number";return/^"/.test(e)?/:$/.test(e)?t="key":t="string":/true|false/.test(e)?t="boolean":/null/.test(e)&&(t="null"),'<span class="'+t+'">'+e+"</span>"})}return e}),angular.module("apks").controller("APKDetailCtrl",["$scope","$rootScope","api","$stateParams","$location",function(e,t,n,r,i){e.apk=!1,t.section="apks",e.subsection="main",e.Object=Object;for(var s in i.$$search)i.search(s,null);e.getApk=function(){n.getAPK(r.sha256).success(function(t){var n=!1;e.apk?n=e.apk.analysis:n=!1,e.apk=t,e.apk.analysis=n,e.apk.show_detections=!1,e.apk.show_votes=!1,e.apk.show_avs=!1,e.getDetections(),e.getVotes(),e.getAVScans()}).error(function(){i.url("/apks")})},e.getApk(),e.download=function(){var e=r.sha256;n.downloadAPK(e)},e.analyze=function(){e.analyzing=!0,n.forzeApkAnalysis(e.apk.sha256).success(function(t){e.analysisRequested=!0}).error(function(t){e.analysisRequestedFailed=!0}).finally(function(){e.analyzing=!1})},e.getDetections=function(){n.getAPKDetections(r.sha256).success(function(t){e.apk.detections=t,e.apk.total_detections=0;for(var n=0;n<t.length;n++)t[n].detected&&e.apk.total_detections++;e.apk.analyzed&&(e.apk.show_detections=!0)})},e.getVotes=function(){n.getAPKVotes(r.sha256,1,25).success(function(t){e.apk.votes=t,t.results.length>0&&(e.apk.show_votes=!0)})},e.setAPKAsTrusted=function(){n.updateAPK(r.sha256,{trusted:!0,detected:!1}).success(function(t){e.apk.trusted=!0,e.apk.detected=!1,e.getApk()})},e.getAVScans=function(){n.getAPKAVScans(r.sha256).success(function(t){e.apk.av_scans=t,e.apk.av_scans.length==0?(e.apk.av_scans=[{total_detections:0,results:[]}],e.apk.show_avs=!1):e.apk.show_avs=!0})}}]),angular.module("apks").controller("APKRatingCtrl",["$scope","api","$stateParams",function(e,t,n){e.sha256=n.sha256,e.userVoted=!1,e.userVote=null,e.getUserVote=function(){t.getUserApkVote(e.sha256).success(function(t){e.userVoted=!0,e.userVote=t}).error(function(){e.userVoted=!1})},e.getUserVote(),e.voteUp=function(){e.userVoted=!0,e.userVote={kind:"positive"},e.$parent.apk.rating=e.$parent.apk.rating+1,t.voteAPK(e.sha256,"positive").success(function(e){})},e.voteDown=function(){e.userVoted=!0,e.userVote={kind:"negative"},e.$parent.apk.rating=e.$parent.apk.rating-1,t.voteAPK(e.sha256,"negative").success(function(e){})}}]),angular.module("apks").controller("APKMainController",["$scope","$rootScope","api","$stateParams","$location",function(e,t,n,r,i){e.$parent.subsection="main"}]),angular.module("apks").controller("APKCommentsController",["$scope","$rootScope","api","$stateParams",function(e,t,n,r){e.$parent.subsection="comments",e.sha256=r.sha256,e.comments=[],e.newComment={},e.nextPage=!1,e.pageChanged=function(){e.getComments()},e.getComments=function(){n.getAPKComments(e.sha256,e.nextPage).success(function(t){e.nextPage=t.next,e.comments=e.comments.concat(t.results)})},e.deleteComment=function(t){confirm("Are you sure?")&&n.deleteComment(t).success(function(){for(var n in e.comments)if(t.id==e.comments[n].id){e.comments.splice(n,1);break}})},e.updateComment=function(e){e.text=e.newtext,n.updateComment(e),e.editing=!1},e.addComment=function(){n.addAPKComment(e.sha256,e.newComment).success(function(i){e.comments.push({author:t.user,created_on:Math.floor(Date.now()/1e3),modified_on:Math.floor(Date.now()/1e3),text:i.text}),n.getAPK(r.sha256).success(function(t){e.$parent.apk.tags=t.tags})}).error(function(e,t){}),e.newComment={}},e.getComments()}]),angular.module("apks").controller("APKAnalysisController",["$scope","api","$stateParams",function(e,t,n){e.$parent.subsection="analysis",e.gettingAnalysis=!1,e.gettingStrings=!1,e.strings="",e.stringsFilter="",e.totalStrings=0,e.stringsPerPage=100,e.currentStringsPage=1,e.downloadAnalysis=function(){window.open("data:text/plain,"+e.encodedAnalysis)},e.getApkAnalysis=function(){e.gettingAnalysis=!0,t.getApkAnalysis(n.sha256,!0).success(function(t){var n=encodeURIComponent(JSON.stringify(t,undefined,4));e.encodedAnalysis=encodeURIComponent(JSON.stringify(t,undefined,4));var r=new Blob([n],{type:"application/json"});e.downloadUrl=(window.URL||window.webkitURL).createObjectURL(r),delete t.status,delete t.sha256,delete t.scanning_date,e.$parent.apk.analysis=t,e.$parent.apk.analysis_json=JSON.stringify(t,undefined,4)}).finally(function(){e.gettingAnalysis=!1})},e.getApkAnalysis(),e.getApkStrings=function(){e.gettingStrings=!0,t.getApkStrings(n.sha256,e.currentStringsPage,e.stringsPerPage=100,{search:e.stringsFilter}).success(function(t){e.strings=t.strings,e.totalStrings=t.count}).finally(function(){e.gettingStrings=!1})},e.stringsPageChanged=function(){e.getApkStrings()},e.filterStrings=function(){e.currentStringsPage=1,e.getApkStrings()}}]),angular.module("apks").controller("APKMetadataController",["$scope","api","$stateParams",function(e,t,n){e.$parent.subsection="metadata",e.getApkMetadata=function(){e.$parent.apk.metadata?e.$parent.$watch("apk",function(){e.$parent.apk&&e.getApkMetadata()},!0):t.getApkMetadata(e.apk.sha256,!0).success(function(t){e.apk.metadata=JSON.stringify(t,undefined,4)})},e.getApkMetadata()}]);angular.module("dashboard",[]),angular.module("dashboard").controller("DashboardCtrl",["$scope","$rootScope","api","$interval","$location","$timeout",function(e,t,n,r,i,s){t.section="dashboard",t.activityType="user-timeline",t.totalAPKDetected=window.totalAPKDetected,t.last24hApks=window.last24hUploads,t.totalAPKs=window.totalAPKs,t.totalSocialRulesets=window.totalSocialRulesets,t.activity_loading=!0;var o=new Date;o.setDate(o.getDate()-1);var u=parseInt(o.getTime()/1e3);e.getActivity=function(){function r(){e.activity_loading=!0,n.getGlobalActivity().success(function(t){e.activity=t.results.slice(0,9)}).finally(function(){e.activity_loading=!1})}function i(){e.activity_loading=!0,n.getAnalystTimeline(t.user.username).success(function(t){e.activity=t.results.slice(0,9),t.results.length==0&&(e.activityType=="global-timeline",r())}).finally(function(){e.activity_loading=!1})}if(!t.user)return setTimeout(function(){e.getActivity()},500),!1;e.activityType=="user-timeline"?i():e.activityType=="global-timeline"&&r()},e.$watch("activityType",function(t,n){t!=n&&(e.activity=[]),e.getActivity()});var a=r(e.getActivity,1e4);e.$on("$destroy",function(e){r.cancel(a)}),s(function(){try{r.cancel(a)}catch(e){}},3e5),t.$watch("user",function(e,n){if(t.user&&t.user.anon){t.activityType="global-timeline";try{r.cancel(a)}catch(i){}}else{t.user&&t.user.followers>0?t.activityType="user-timeline":t.activityType="global-timeline";try{r.cancel(a)}catch(i){}}},!0),e.go=function(e,t){t=t?t:null,i.path(e).search("search",t)},e.go24HoursUploads=function(){var e=Math.round((new Date).getTime()/1e3),t=e-86400;i.path("/apks")}}]),angular.module("dashboard").controller("LastApksCtrl",["$scope","$rootScope","api","$interval","$timeout",function(e,t,n,r,i){function s(){e.loading=!0,n.getAPKs().success(function(t){e.apks=t.results.slice(0,8)}).finally(function(){e.loading=!1})}var o=r(s,15e3);e.$on("$destroy",function(e){r.cancel(o)}),i(function(){try{r.cancel(o)}catch(e){}},3e5),t.$watch("user",function(){if(t.user&&t.user.anon){t.activityType="global-timeline";try{r.cancel(o)}catch(e){}}else t.activityType="user-timeline"},!0),s()}]),angular.module("dashboard").controller("LatestAnalystsController",["$scope","api",function(e,t){t.getLatestAnalysts().success(function(t){e.latest_analysts=t.slice(0,3)})}]),angular.module("dashboard").controller("TrendingAnalystsController",["$scope","$rootScope","api","$interval","$timeout",function(e,t,n,r,i){n.getTrendingAnalysts().success(function(t){e.trending_analysts=t.slice(0,8)})}]);angular.module("my_rulesets",["ui.codemirror","filters","ui.bootstrap"]),angular.module("my_rulesets").controller("MyRulesetsCtrl",["$scope","$rootScope","$timeout","api","$uibModal","$location","$state",function(e,t,n,r,i,s,o){var u=e;e.rulesets={},t.section="rulesets",t.sidebar_sub_section="my_rulesets",e.itemsPerPage=10,e.currentPage=1,e.filters={active:"",privacy:"",ordering:"-modified_on",social:""},e.$watch("filters",function(){e.currentPage=1,e.getRulesets()},!0),e.$on("$destroy",function(){t.sidebar_sub_section=null}),e.pageChanged=function(){e.getRulesets()},e.maxSize=5,e.getRulesets=function(){r.getRulesets(e.currentPage,e.itemsPerPage,e.filters).success(function(t){e.rulesets=t.results,e.totalItems=t.count})},e.editRuleset=function(e){s.path("/rulesets/"+e.id)},e.newRuleset=function(){var e='import "androguard"\nimport "file"\nimport "cuckoo"\n\n\nrule koodous : official\n{\n	meta:\n		description = "This rule detects the koodous application, used to show all Yara rules potential"\n		sample = "e6ef34577a75fc0dc0a1f473304de1fc3a0d7d330bf58448db5f3108ed92741b"\n\n	strings:\n		$a = {63 6F 6D 24 6B 6F 6F 64 6F 75 73 24 61 6E 64 72 6F 69 64}\n\n	condition:\n		androguard.package_name("com.koodous.android") and\n		androguard.app_name("Koodous") and\n		androguard.activity(/Details_Activity/i) and\n		androguard.permission(/android.permission.INTERNET/) and\n		androguard.certificate.sha1("8399A145C14393A55AC4FCEEFB7AB4522A905139") and\n		androguard.url(/koodous\\.com/) and\n		not file.md5("d367fd26b52353c2cce72af2435bd0d5") and \n		$a and\n		cuckoo.network.dns_lookup(/settings.crashlytics.com/) //Yes, we use crashlytics to debug our app!\n		\n}',t={name:"New Ruleset",rules:e,active:!1};r.saveRuleSet(t).success(function(e){o.go("my_rulesets_detail",{id:e.id})})}}]),angular.module("my_rulesets").controller("MyRuleSetDetailController",["$scope","$rootScope","$stateParams","api","$location","$timeout","$interval","$uibModal",function(e,t,n,r,i,s,o,u){t.section="rulesets",r.getRuleset(n.id).success(function(t){e.ruleset=t,e.editorOptions={lineWrapping:!0,lineNumbers:!0,indentWithTabs:!0,mode:"yara"},s(function(){e.rulesetChanged=!1},10)}).error(function(){i.path("/rulesets")}),e.$watch("ruleset.rules",function(t,n){t!=n&&(e.rulesetChanged=!0)});var a=o(function(){e.rulesetChanged&&e.autosave&&(e.save(),e.rulesetChanged=!1)},2e3);e.$on("$destroy",function(e){o.cancel(a)}),e.autosave=!0,e.save=function(){e.compilationError=!1,e.saving=!0,e.rulesetChanged=!1,e.previousState=e.ruleset.active,r.saveRuleSet(e.ruleset).success(function(t){e.ruleset.active=t.active,e.ruleset.id=t.id,e.modified_on=t.modified_on,e.ruleset.social&&!t.social&&(e.social_revokation=!0),e.ruleset.social=t.social}).error(function(t,n){e.ruleset.active=t.active,e.ruleset.id=t.id,n==406&&(e.compilationError=!0,e.compilationErrorText=t.error)}).finally(function(){e.saving=!1})},e.cancel=function(){r.getRuleset(e.ruleset.id).success(function(t){e.ruleset=t,e.rulesetChanged=!1})},e.delete=function(){confirm("Are you sure?")&&r.deleteRuleset(e.ruleset).success(function(e){i.path("/rulesets")})},e.openHelpDialog=function(){var e=u.open({templateUrl:window.ANGULAR_TEMPLATES_URLS["frontend/app/my_rulesets/about_social_ruleset_dialog.html"],controller:"AboutSocialRulesetDialogController"})},e.openSocialPromotionDialog=function(){var t=u.open({templateUrl:window.ANGULAR_TEMPLATES_URLS["frontend/app/my_rulesets/promote_social_dialog.html"],controller:"SocialPromotionDialogController",resolve:{scope:function(){return e}}})}}]),angular.module("my_rulesets").controller("AboutSocialRulesetDialogController",["$uibModalInstance","$scope",function(e,t){t.ok=function(){e.close()}}]),angular.module("my_rulesets").controller("SocialPromotionDialogController",["$uibModalInstance","$scope","api","scope","$stateParams",function(e,t,n,r,i){t.checked=!1,t.valid=!1,t.ruleset=r.ruleset,t.close=function(){e.close()},t.ok=function(){t.checking=!0,t.ruleset.pending_social=!0,n.promoteRuleset(t.ruleset),e.close()}}]);angular.module("notifications",[]),angular.module("notifications").controller("NotificationsCtrl",["$scope","$rootScope","$stateParams","api","$location",function(e,t,n,r,i){t.section="notifications",e.nextPage,e.notifications=[],e.notification_type=n.notification_type?n.notification_type:"",e.thereIsMore=!0,e.search="",e.nextPage=!1,e.loading=!1,e.$watch("notification_type",function(t,n){t!=n&&(e.nextPage=!1,e.notifications=[],e.getNotifications())}),t.$watch("user",function(){t.user&&t.user.anon&&i.path("/")},!0),$(window).scroll(function(){$(window).scrollTop()+$(window).height()==$(document).height()&&!e.loading&&e.nextPage&&e.getNotifications()}),e.$on("$destroy",function(e){$(window).unbind("scroll")}),e.markAsRead=function(e){e.read=!0,r.updateNotification(e).success(function(){t.getUnreadNotifications()})},e.markAllAsRead=function(){r.markAllNotificationsAsRead().success(function(){t.getUnreadNotifications(),e.nextPage=!1,e.notifications=[],e.getNotifications()})},e.searchNotifications=function(){e.nextPage=!1,e.notifications=[],e.getNotifications()},e.getNotifications=function(){e.loading=!0,r.getNotifications(e.nextPage,{search:e.search,type:e.notification_type}).success(function(t){e.nextPage=t.next,e.notifications=e.notifications.concat(t.results)}).finally(function(){e.loading=!1})},e.getNotifications()}]);angular.module("ranking",[]),angular.module("ranking").controller("RankingCtrl",["$scope","$rootScope","api",function(e,t,n){t.section="ranking",e.itemsPerPage=25,e.currentPage=1,e.firstUser=null,e.secondUser=null,e.thirdUser=null,e.getAnalysts=function(){n.getAnalysts(e.currentPage,e.itemsPerPage,{ordering:"-total_followers"}).success(function(t){e.analysts=t.results,e.totalItems=t.count,e.firstUser=e.firstUser?e.firstUser:t.results[0],e.secondUser=e.secondUser?e.secondUser:t.results[1],e.thirdUser=e.thirdUser?e.thirdUser:t.results[2]})},e.getAnalysts(),e.pageChanged=function(){e.getAnalysts()}}]);angular.module("app").controller("RegisterController",["$scope","$rootScope","api","$location","$stateParams",function(e,t,n,r,i){t.$watch("user",function(){t.user&&t.user.username&&r.path("/")},!0),e.register=function(){},e.activate=function(){e.activation_loading=!0,e.activation_success=!1,e.activation_error=!1,console.log(i.code)}}]);angular.module("rulesets",["ui.codemirror","filters","ui.bootstrap"]),angular.module("rulesets").controller("RulesetsCtrl",["$scope","$stateParams","$rootScope","$timeout","api","$uibModal","$location","$state",function(e,t,n,r,i,s,o,u){var a=e;e.rulesets={},n.section="rulesets",n.sidebar_sub_section="community_rulesets",e.itemsPerPage=20,e.currentPage=1,e.filters={social:""},n.search=t.search?t.search:"",e.$watch("filters",function(t,r){e.filters.search=n.search,e.currentPage=1,e.loading||e.getRulesets()},!0),e.$on("$destroy",function(){n.sidebar_sub_section=null}),e.pageChanged=function(){e.getRulesets()},e.maxSize=5,e.getRulesets=function(){e.loading=!0,i.getPublicRulesets(e.currentPage,e.itemsPerPage,e.filters).success(function(t){e.rulesets=t.results,e.totalItems=t.count}).finally(function(){e.loading=!1})},n.searchRulesets=function(){n.search!==""?e.filters.search=n.search:delete e.filters.search,n.search?o.search("search",n.search):o.search("search",null),e.getRulesets()}}]),angular.module("rulesets").controller("RulesetController",["$scope","$rootScope","$stateParams","api",function(e,t,n,r){t.section="rulesets",e.subSection="main",e.userVoted=!1,e.userVote=null,e.getRuleset=function(){r.getPublicRuleset(n.id).success(function(t){e.ruleset=t,e.editorOptions={lineWrapping:!0,lineNumbers:!0,indentWithTabs:!0,mode:"yara",readOnly:!0}}).error(function(){$location.path("/rulesets")})},e.getRuleset(),e.getUserVote=function(){r.getUserRulesetVote(n.id).success(function(t){e.userVoted=!0,e.userVote=t}).error(function(){e.userVoted=!1})},e.getUserVote(),e.voteUp=function(){e.userVoted=!0,e.userVote={kind:"positive"},e.ruleset.rating=e.ruleset.rating+1,r.voteRuleset(n.id,"positive").success(function(e){})},e.voteDown=function(){e.userVoted=!0,e.userVote={kind:"negative"},e.ruleset.rating=e.ruleset.rating-1,r.voteRuleset(n.id,"negative").success(function(e){})}}]),angular.module("rulesets").controller("RulesetMainController",["$scope","$rootScope","$stateParams","api",function(e,t,n,r){e.codeCollapsed=!0,e.$parent.subSection="main"}]),angular.module("rulesets").controller("RulesetCommentsController",["$scope","$rootScope","$stateParams","api",function(e,t,n,r){e.totalComments=0,e.comments=[],e.newComment={},e.nextPage=!1,e.loading=!1,e.pageChanged=function(){e.getComments()},e.getComments=function(){e.loading=!0,r.getRulesetComments(n.id,e.nextPage).success(function(t){e.comments=e.comments.concat(t.results),e.nextPage=t.next}).finally(function(){e.loading=!1})},e.deleteComment=function(t){confirm("Are you sure?")&&r.deleteComment(t).success(function(){for(var n in e.comments)if(t.id==e.comments[n].id){e.comments.splice(n,1);break}})},e.updateComment=function(e){e.text=e.newtext,r.updateComment(e),e.editing=!1},e.addComment=function(){r.addRulesetComment(n.id,e.newComment).success(function(n){e.comments.push({author:t.user,created_on:Math.floor(Date.now()/1e3),modified_on:Math.floor(Date.now()/1e3),text:n.text})}).error(function(e,t){}),e.newComment={}},e.getComments()}]),angular.module("rulesets").controller("RulesetDetectionsController",["$scope","$rootScope","$stateParams","api","$state",function(e,t,n,r,i){e.$parent.subSection="detections",e.maxSize=5,e.apks=[],e.nextPage=!1,e.currentPage=!1,t.section="rulesets",e.showFilters=!1,e.filters={analyzed:n.analyzed?n.analyzed:"",repo:n.repo?n.repo:""},t.search=n.search?n.search:"",e.$watch("filters",function(n,r){e.filters.search=t.search,e.nextPage=!1,e.loading||e.getAPKS()},!0),$(window).scroll(function(){$(window).scrollTop()+$(window).height()==$(document).height()&&!e.loading&&e.nextPage&&e.getAPKS()}),e.$on("$destroy",function(e){$(window).unbind("scroll")}),e.pageChanged=function(){e.getAPKS()},e.getAPKS=function(){function s(t){e.currentPage=e.nextPage,e.nextPage=t.next,i&&(i.sha256||i.sha1||i.md5)?t.results.length?$location.path("/apks/"+t.results[0].sha256):e.apks=e.apks.concat(t.results):e.apks=e.apks.concat(t.results)}e.loading=!0,t.searchError=!1;var i=e.filters;r.getRulesetDetections(n.id,e.nextPage,i).success(s).error(function(n){t.searchError=n.error,e.apks=[],e.totalItems=0}).finally(function(){e.loading=!1})},t.searchApks=function(){i.go(i.current.name,{search:t.search})},e.removeMatches=function(){e.removingMatches=!0,r.removeRulesetMatches(n.id,{search:t.search}).success(function(t){e.getAPKS()}).finally(function(){e.removingMatches=!1})},e.removeMatch=function(t){r.removeRulesetMatch(n.id,t.sha256).success(function(t){e.nextPage=e.currentPage,e.getAPKS()})}}]);angular.module("settings",["ja.qr"]),angular.module("settings").controller("SettingsController",["$scope","$stateParams",function(e,t){var n=["profile","account","link_device"];e.section=t.section,n.indexOf(e.section)<=-1&&(e.section=n[0])}]),angular.module("settings").controller("ProfileController",["$scope","$rootScope","api",function(e,t,n){e.alerts=[],e.updateAvatar=function(r){if(!r.length)return!1;r=r[0],n.updateAvatar(t.user.username,r).success(function(n){t.user.avatar_url=n.avatar_url,e.addAlert("success","Your avatar has been uploaded")}).error(function(){e.addAlert("danger","An error ocurred uploading your avatar")})},e.api_token=localStorage.authToken?localStorage.authToken:sessionStorage.authToken,e.addAlert=function(t,n){e.alerts.push({msg:n,type:t})},e.closeAlert=function(t){e.alerts.splice(t,1)},e.updateUserInfo=function(){n.updateUserInfo(t.user).success(function(n){t.user=n,e.addAlert("success","Your profile information has been saved")}).error(function(){e.addAlert("danger","An error ocurred saving your profile information")})}}]),angular.module("settings").controller("AccountController",["$scope","$rootScope","api",function(e,t,n){e.alerts=[],e.addAlert=function(t,n){e.alerts.push({msg:n,type:t})},e.closeAlert=function(t){e.alerts.splice(t,1)},e.changePassword=function(){e.alerts=[];var r={old_password:e.old_password,new_password:e.new_password,new_password2:e.new_password2};n.changeUserPassword(t.user,r).success(function(t){e.old_password=e.new_password=e.new_password2="",e.addAlert("success","Your password has been changed")}).error(function(t){t.error&&e.addAlert("danger",t.error),t.new_password&&e.addAlert("danger","New password: "+t.new_password),t.new_password&&e.addAlert("danger","New password2: "+t.new_password),t.non_field_errors&&e.addAlert("danger",t.non_field_errors)})}}]),angular.module("settings").controller("DevicesController",["$scope","$rootScope","api",function(e,t,n){e.title="Link device",e.qrcode="",e.loading=!0,e.getDevices=function(){n.getUserDevices().success(function(t){e.devices=t.results})},e.getQRCode=function(){n.getLinkDeviceToken().success(function(t){setTimeout(function(){e.qrcode=t.token,e.loading=!1,e.$digest()},500)})},e.getQRCode(),e.getDevices()}]),angular.module("settings").controller("NotificationsController",["$scope","$rootScope","api",function(e,t,n){e.successAlert=!1,n.getUserSettings().success(function(t){e.settings=t}),e.updateSettings=function(){n.updateUserSettings(e.settings).success(function(){e.successAlert=!0})},e.closeAlert=function(){e.successAlert=!1}}]);app.controller("SignInUpController",["$scope","$state","$uibModal","$stateParams","api",function(e,t,n,r,i){switch(t.current.name){case"register":var s=n.open({templateUrl:"/app/signinup/register.html",controller:"RegisterController",backdropClass:"fullscreen-modal",backdrop:"static"});break;case"login":var s=n.open({templateUrl:"/app/signinup/login.html",controller:"LoginController",backdropClass:"fullscreen-modal",backdrop:"static"});break;case"activate":i.activate(r.token).success(function(e){document.location.href="/login"}).error(function(){document.location.href="/"});break;case"forgot_password":var s=n.open({templateUrl:"/app/signinup/forgot.html",controller:"ForgotController",backdropClass:"fullscreen-modal",backdrop:"static"});break;case"reset_password":var s=n.open({templateUrl:"/app/signinup/reset.html",controller:"ResetController",backdropClass:"fullscreen-modal",backdrop:"static"})}}]),app.controller("RegisterController",["$scope","$uibModalInstance","api",function(e,t,n){e.user={},e.error=!1,e.error_message="",e.registration_done=!1,e.register=function(){e.error=!1,e.error_message="";if(e.user.password!=e.password2){e.error=!0,e.error_message="Passwords should be the same";return}if(!e.terms_accepted){e.error=!0,e.error_message="Terms of use & privacy policy should be accepted";return}n.register(e.user).success(function(t){e.registration_done=!0}).error(function(t){e.error=!0,e.error_message=t.error})},e.close=function(e){e&&(document.location.href="/"),t.close()}}]),app.controller("LoginController",["$scope","$rootScope","api","$location","$uibModalInstance",function(e,t,n,r,i){e.error=!1,e.loading=!1,e.remember=!0,e.error_message="Incorrect username or password.",t.$watch("user",function(){t.user&&t.user.username&&e.close(!0)},!0),e.close=function(e){e&&(document.location.href="/"),i.close()},e.submit=function(){e.error=!1,e.loading=!0,n.getUserToken(e.username,e.password).success(function(r){e.remember?localStorage.authToken=r.token:sessionStorage.authToken=r.token,n.getCurrentUser().success(function(e){t.user=e,document.location.href="/login"}).error(function(){t.user={anon:!0}})}).error(function(){e.error=!0}).finally(function(){e.loading=!1})}}]),app.controller("ForgotController",["$scope","$uibModalInstance","api",function(e,t,n){e.done=!1,e.close=function(e){e&&(document.location.href="/"),t.close()},e.submit=function(){e.error=!1,e.loading=!0,e.done=!1,n.forgotPassword(e.email).success(function(t){e.done=!0}).error(function(){e.error_message="Enter your an valid email address.",e.error=!0}).finally(function(){e.loading=!1})}}]),app.controller("ResetController",["$scope","$state","api",function(e,t,n){e.uid=t.params.uid,e.token=t.params.token,e.close=function(e){e&&(document.location.href="/"),$uibModalInstance.close()},e.submit=function(){e.error=!1,e.loading=!0,e.reset_done=!1;if(!e.new_password1){e.error=!0,e.error_message="All fields are required";return}if(e.new_password1!=e.new_password2){e.error=!0,e.error_message="Passwords should be the same";return}n.resetPassword(e.uid,e.token,e.new_password1,e.new_password2).success(function(t){e.reset_done=!0}).error(function(){e.error_message="Unexpected error!",e.error=!0}).finally(function(){e.loading=!1})}}]);angular.module("app").directive("addCommentWidget",function(){return{restrict:"E",templateUrl:"app/common/directives/add_comment_widget.html",replace:!0,controller:["$scope","api",function(e,t){e.people=[],e.searchUser=function(n){n.length>1?t.getAnalysts(1,5,{search:n}).success(function(t){e.people=t.results}):e.people=[]}}]}});angular.module("app").directive("analystTimeline",function(){return{restrict:"E",templateUrl:"app/common/directives/analyst_timeline.html",controller:["$scope",function(e){}]}});angular.module("directives.comment",[]).directive("comment",function(){return{restrict:"E",templateUrl:"app/common/directives/comment.html",replace:!0,controller:["$scope","$rootScope",function(e,t){e.edit=function(){},e.delete=function(){}}]}});angular.module("app").directive("userWidget",function(){return{restrict:"E",replace:!0,templateUrl:"app/common/directives/user_widget.html",controller:["$scope",function(e){e.follow=function(){},e.unFollow=function(){}}]}});angular.module("filters",[]).filter("truncate",function(){return function(e,t,n){return isNaN(t)&&(t=10),n===undefined&&(n="..."),e.length<=t||e.length-n.length<=t?e:String(e).substring(0,t-n.length)+n}}),angular.module("filters").filter("slice",function(){return function(e,t,n){return(e||[]).slice(t,n)}}),angular.module("filters").filter("bytes",function(){return function(e,t){if(isNaN(parseFloat(e))||!isFinite(e))return"-";if(e===0)return"0 bytes";typeof t=="undefined"&&(t=1);var n=["bytes","kB","MB","GB","TB","PB"],r=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(r))).toFixed(t)+" "+n[r]}}),angular.module("filters").filter("mentions",function(){return function(e){var t=[],n=e.split(" ");for(var r=0;r<n.length;r++)n[r].startsWith("@")&&t.push(n[r]);for(var r=0;r<t.length;r++){var n=t[r].replace("@","");n="<a href='/analysts/"+n+"'>@"+n+"</a>",e=e.replace(t[r],n)}return e}}),angular.module("filters").filter("hashtags",function(){return function(e){var t=[],n=e.split(" ");for(var r=0;r<n.length;r++)n[r].startsWith("#")&&t.push(n[r]);for(var r=0;r<t.length;r++){var n=t[r].replace("#","");n="<a href='/apks?search=tag:"+n+"' class='label label-info mr-sm'>#"+n+"</a>",e=e.replace(t[r],n)}return e}});angular.module("services.api",[]).factory("api",["$http","$window","$location","$upload",function(e,t,n,r){var i={};return i.user=null,i.base_api_url=window.base_api_url,i.getCurrentUser=function(){var t=e({method:"GET",url:i.base_api_url+"/analysts/current",cache:!0});return t.success(function(e){i.user=e}).error(function(e,t){i.user=!1})},i.getLatestAnalysts=function(){var t=e({method:"GET",url:i.base_api_url+"/analysts/latest",cache:!0});return t},i.getTrendingAnalysts=function(){var t=e({method:"GET",url:i.base_api_url+"/analysts/trending",cache:!0});return t},i.getUserToken=function(t,n){data={username:t,password:n};var r=e({method:"POST",url:i.base_api_url+"/get_auth_token",data:data,cache:!0});return r},i.register=function(t){var n=e({method:"POST",url:i.base_api_url+"/register",data:t}).success(function(e){});return n},i.activate=function(t){var n=e({method:"GET",url:i.base_api_url+"/register/activate",params:{token:t}});return n},i.forgotPassword=function(t){var n=e({method:"POST",url:i.base_api_url+"/register/forgot_password",data:{email:t}});return n},i.resetPassword=function(t,n,r,s){var o=e({method:"POST",url:i.base_api_url+"/register/reset_password",params:{uid:t,token:n},data:{new_password1:r,new_password2:s}});return o},i.getAPKUploadUrl=function(t){var n=i.base_api_url+"/apks/"+t+"/get_upload_url",r=e({method:"GET",url:n});return r},i.uploadAPK=function(e){var t=new FileReader;t.onloadend=function(){var n=sha256_digest(t.result),r=i.getAPKUploadUrl(n);r.success(function(t){function i(e){if(e.lengthComputable){var t=String(e.loaded/e.total*100+"%");console.info("Subida: "+t)}}var n=t.upload_url;if(!n)return console.error("KoodousAPI.uploadAPK: No hay url de subida"),!1;var r=new FormData;r.append("file",e),$.ajax({url:n,type:"POST",data:r,xhr:function(){return myXhr=$.ajaxSettings.xhr(),myXhr.upload&&myXhr.upload.addEventListener("progress",i,!1),myXhr},beforeSend:function(){},success:function(e){},error:function(e){alert("Error: "+e.status+" "+e.statusText)},cache:!1,contentType:!1,processData:!1})})},t.readAsArrayBuffer(e)},i.getAPKs=function(t,n,r){var s={};r=r?r:!1,t=t?t:i.base_api_url+"/apks?cursor=";for(var o in n)n[o]!==""&&(t+="&"+o+"="+encodeURIComponent(n[o]));var u=e({method:"GET",url:t,cache:r});return u},i.getAPK=function(t){var n=e({method:"GET",url:i.base_api_url+"/apks/"+t});return n},i.getApkAnalysis=function(t,n){n=n?!0:!1;var r=e({method:"GET",url:i.base_api_url+"/apks/"+t+"/analysis",cache:n});return r},i.forzeApkAnalysis=function(t){var n=e({method:"GET",url:i.base_api_url+"/apks/"+t+"/analyze"});return n},i.getApkStrings=function(t,n,r,s,o){var u={};n=n?n:0;var a=r?r:100;o=o?o:!1;var f=i.base_api_url+"/apks/"+t+"/strings?page="+n;for(var l in s)s[l]!==""&&(f+="&"+l+"="+s[l]);var c=e({method:"GET",url:f});return c},i.getApkMetadata=function(t,n){n=n?!0:!1;var r=e({method:"GET",url:i.base_api_url+"/apks/"+t+"/metadata",cache:n});return r},i.getRulesets=function(t,n,r,s){var o={};t=t?t:0;var u=n?n:50;s=s?s:!1;var a=i.base_api_url+"/user_rulesets?page="+t+"&page_size="+u;for(var f in r)a+="&"+f+"="+encodeURIComponent(r[f]);var l=e({method:"GET",url:a});return l},i.getRuleset=function(t){var n=e({method:"GET",url:i.base_api_url+"/user_rulesets/"+t});return n},i.saveRuleSet=function(t){var n=i.base_api_url+"/user_rulesets",r="POST";t.id?(r="PATCH",n=n+"/"+t.id):r="POST";var s=e({method:r,data:t,url:n,headers:{"Content-Type":"application/json"}});return s},i.deleteRuleset=function(t){var n=i.base_api_url+"/user_rulesets/"+t.id,r=e({method:"DELETE",url:n});return r},i.promoteRuleset=function(t){var n=i.base_api_url+"/user_rulesets/"+t.id+"/promote_social",r=e({method:"POST",url:n});return r},i.getPublicRulesets=function(t,n,r,s){var o={};t=t?t:0;var u=n?n:50;s=s?s:!1;var a=i.base_api_url+"/public_rulesets?page="+t+"&page_size="+u;for(var f in r)a+="&"+f+"="+encodeURIComponent(r[f]);var l=e({method:"GET",url:a});return l},i.getPublicRuleset=function(t){var n=e({method:"GET",url:i.base_api_url+"/public_rulesets/"+t});return n},i.getRulesetComments=function(t,n,r){var s={};n=n?n:i.base_api_url+"/public_rulesets/"+t+"/comments?cursor=";for(var o in r)n+="&"+o+"="+r[o];var u=e({method:"GET",url:n});return u},i.addRulesetComment=function(t,n){var r=e({method:"POST",data:n,url:i.base_api_url+"/public_rulesets/"+t+"/comments"});return r},i.getAPKComments=function(t,n,r){var s={};n=n?n:i.base_api_url+"/apks/"+t+"/comments?cursor=";for(var o in r)n+="&"+o+"="+r[o];var u=e({method:"GET",url:n});return u},i.addAPKComment=function(t,n){var r=e({method:"POST",data:n,url:i.base_api_url+"/apks/"+t+"/comments"});return r},i.updateComment=function(t){var n=e({method:"PATCH",data:t,url:i.base_api_url+"/comments/"+t.id});return n},i.deleteComment=function(t){var n=e({method:"DELETE",url:i.base_api_url+"/comments/"+t.id});return n},i.voteAPK=function(t,n){var r=e({method:"POST",data:{kind:n},url:i.base_api_url+"/apks/"+t+"/votes"});return r},i.voteRuleset=function(t,n){var r=e({method:"POST",data:{kind:n},url:i.base_api_url+"/public_rulesets/"+t+"/votes"});return r},i.downloadAPK=function(t){var n=e({method:"GET",url:i.base_api_url+"/apks/"+t+"/download"}).success(function(e){e.download_url?document.location.href=e.download_url:alert("No hay url de descarga")})},i.getAPKDetections=function(t){var n=e({method:"GET",url:i.base_api_url+"/apks/"+t+"/detections"});return n},i.getAPKSocialDetections=function(t){var n=e({method:"GET",url:i.base_api_url+"/apks/"+t+"/social_detections"});return n},i.getAPKVotes=function(t,n,r,s){var o={};n=n?n:0;var u=r?r:50,a=i.base_api_url+"/apks/"+t+"/votes?page="+n+"&page_size="+u;for(var f in s)a+="&"+f+"="+s[f];var l=e({method:"GET",url:i.base_api_url+"/apks/"+t+"/votes"});return l},i.getAPKAVScans=function(t){var n=e({method:"GET",url:i.base_api_url+"/apks/"+t+"/av_scans"});return n},i.updateAPK=function(t,n){var r="/api/apks/"+t,i=e({method:"PATCH",url:r,data:n,headers:{"Content-Type":"application/json"}});return i},i.getUnreadNotifications=function(){return i.getNotifications(!1,{read:"False"})},i.getNotifications=function(t,n){var r={};t=t?t:i.base_api_url+"/notifications?cursor=";for(var s in n)t+="&"+s+"="+n[s];var o=e({method:"GET",url:t});return o},i.updateNotification=function(t){var n="/api/notifications/"+t.id,r={read:t.read},i=e({method:"PATCH",url:n,data:r,headers:{"Content-Type":"application/json"}});return i},i.markAllNotificationsAsRead=function(){var t="/api/notifications/mark_all_as_read",n=e({method:"POST",url:t,headers:{"Content-Type":"application/json"}});return n},i.getComments=function(t,n){var r={};t=t?t:i.base_api_url+"/comments?cursor=";for(var s in n)t+="&"+s+"="+n[s];var o=e({method:"GET",url:t});return o},i.getUserComments=function(t,n,r){var s={};n=n?n:i.base_api_url+"/analysts/"+t+"/comments?cursor=";for(var o in r)n+="&"+o+"="+r[o];var u=e({method:"GET",url:n});return u},i.getUserFollowers=function(t,n,r,s){var o={};n=n?n:1;var u=r?r:50,a=i.base_api_url+"/analysts/"+t+"/followers?page="+n+"&page_size="+u;for(var f in s)a+="&"+f+"="+s[f];var l=e({method:"GET",url:a});return l},i.getUserFollowing=function(t,n,r,s){var o={};n=n?n:1;var u=r?r:50,a=i.base_api_url+"/analysts/"+t+"/following?page="+n+"&page_size="+u;for(var f in s)a+="&"+f+"="+s[f];var l=e({method:"GET",url:a});return l},i.getUserFollowersInifite=function(t,n){var r={};if(!n)var s=i.base_api_url+"/analysts/"+t+"/followers";else var s=n;var o=e({method:"GET",url:s});return o},i.getUserFollowingInifite=function(t,n){var r={};if(!n)var s=i.base_api_url+"/analysts/"+t+"/following";else var s=n;var o=e({method:"GET",url:s});return o},i.getUserRulesets=function(t,n,r,s){var o={};n=n?n:1;var u=r?r:50,a=i.base_api_url+"/analysts/"+t+"/rulesets?page="+n+"&page_size="+u;for(var f in s)a+="&"+f+"="+s[f];var l=e({method:"GET",url:a});return l},i.getRulesetDetections=function(t,n,r,s){var o={};s=s?s:!1,n=n?n:i.base_api_url+"/ruleset_matches/"+t+"/apks?cursor=";for(var u in r)r[u]!==""&&(n+="&"+u+"="+r[u]);var a=e({method:"GET",url:n,cache:s});return a},i.getDeviceAPKs=function(t,n,r,s){var o={};s=s?s:!1,n=n?n:i.base_api_url+"/devices/"+t+"/apks?cursor=";for(var u in r)r[u]!==""&&(n+="&"+u+"="+r[u]);var a=e({method:"GET",url:n,cache:s});return a},i.getAnalysts=function(t,n,r){var s={};t=t?t:0;var o=n?n:50,u=i.base_api_url+"/analysts?page="+t+"&page_size="+o;for(var a in r)u+="&"+a+"="+r[a];var f=e({method:"GET",url:u});return f},i.getAnalyst=function(t){var n=i.base_api_url+"/analysts/"+t,r=e({method:"GET",url:n});return r},i.followUser=function(t){var n={},r=e({method:"GET",url:i.base_api_url+"/analysts/"+t+"/follow",data:n});return r},i.unFollowUser=function(t){var n={},r=e({method:"GET",url:i.base_api_url+"/analysts/"+t+"/unfollow",data:n});return r},i.updateAvatar=function(e,t){var n="/api/analysts/"+e,i=r.upload({url:n,method:"PATCH",file:t,fileFormDataName:"avatar"});return i},i.updateUserInfo=function(e){var t="/api/analysts/"+e.username,n=r.upload({url:t,method:"PATCH",data:e});return n},i.changeUserPassword=function(t,n){var r="/api/analysts/"+t.username+"/set_password",i=e({method:"POST",url:r,data:n});return i},i.getAnalystActivity=function(t,n,r){var s={};n=n?n:i.base_api_url+"/analysts/"+t+"/activity?cursor=";for(var o in r)n+="&"+o+"="+r[o];var u=e({method:"GET",url:n});return u},i.getGlobalActivity=function(t,n,r){var s={};t=t?t:1;var o=n?n:10,u=i.base_api_url+"/activity?page="+t+"&page_size="+o;for(var a in r)u+="&"+a+"="+r[a];var f=e({method:"GET",url:u});return f},i.getAnalystTimeline=function(t,n,r,s){var o={};n=n?n:1;var u=r?r:10,a=i.base_api_url+"/analysts/"+t+"/following/activity?page="+n+"&page_size="+u;for(var f in s)a+="&"+f+"="+s[f];var l=e({method:"GET",url:a});return l},i.getUserApkVote=function(t){var n={},r=e({method:"GET",url:i.base_api_url+"/apks/"+t+"/user_vote"});return r},i.getUserRulesetVote=function(t){var n={},r=e({method:"GET",url:i.base_api_url+"/public_rulesets/"+t+"/user_vote"});return r},i.getLinkDeviceToken=function(){var t={},n=e({method:"POST",url:i.base_api_url+"/device_link"});return n},i.getInvitations=function(){var t={},n=e({method:"GET",url:i.base_api_url+"/invitations"});return n},i.createInvitation=function(t){var n=e({method:"POST",url:i.base_api_url+"/invitations",data:t});return n},i.deleteInvitation=function(t){var n=e({method:"DELETE",url:i.base_api_url+"/invitations/"+t.id});return n},i.getUserDevices=function(){var t={},n=e({method:"GET",url:i.base_api_url+"/devices"});return n},i.removeRulesetMatches=function(t,n){var r=i.base_api_url+"/ruleset_matches/"+t+"/apks/remove_matches";n=n?n:{},r+="?search="+n.search;var s=e({method:"DELETE",url:r});return s},i.removeRulesetMatch=function(t,n){var r=e({method:"DELETE",url:i.base_api_url+"/ruleset_matches/"+t+"/apks/"+n});return r},i.getUserSettings=function(){var t=e({method:"GET",url:i.base_api_url+"/settings"});return t},i.updateUserSettings=function(t){var n=e({method:"PATCH",url:i.base_api_url+"/settings",data:t});return n},i}]);